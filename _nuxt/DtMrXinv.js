const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./DvzcJRrA.js","./DwRx5_27.js","./entry.i2GymcVm.css"])))=>i.map(i=>d[i]);
import{I as g}from"./DwRx5_27.js";import{c as d,a as w,t as u}from"./9oLxojRO.js";async function p(t,r){return await $fetch(`/__nuxt_content/${r}/sql_dump`,{context:{},responseType:"text",headers:{"content-type":"text/plain"},query:{v:d[String(r)],t:void 0}})}async function S(t,r="gzip"){var c;const e=Uint8Array.from(atob(t),l=>l.charCodeAt(0)),a=(c=new Response(new Blob([e])).body)==null?void 0:c.pipeThrough(new DecompressionStream(r));return(await new Response(a).text()).split(`
`)}function f(t,r){const e=h(t),n={...r};for(const a in n)e[a]==="json"&&n[a]&&n[a]!=="undefined"&&(n[a]=JSON.parse(n[a])),e[a]==="boolean"&&n[a]!=="undefined"&&(n[a]=!!n[a]);for(const a in n)n[a]==="NULL"&&(n[a]=void 0);return n}function h(t){const r=t.match(/FROM\s+(\w+)/);if(!r)return{};const e=w[b(r[1])];return(e==null?void 0:e.fields)||{}}function b(t){return t.replace(/^_content_/,"")}let o;const m={},s={};function R(t){async function r(e){return o||(s._=s._||_(),o=await s._,Reflect.deleteProperty(s,"_")),m[String(e)]||(s[String(e)]=s[String(e)]||y(e),await s[String(e)],m[String(e)]="loaded",Reflect.deleteProperty(s,String(e))),o}return{all:async(e,n)=>(await r(t),o.exec({sql:e,bind:n,rowMode:"object",returnValue:"resultRows"}).map(a=>f(e,a))),first:async(e,n)=>(await r(t),f(e,o.exec({sql:e,bind:n,rowMode:"object",returnValue:"resultRows"}).shift())),exec:async(e,n)=>{await r(t),await o.exec({sql:e,bind:n})}}}async function _(){if(!o){const t=await g(()=>import("./DvzcJRrA.js"),__vite__mapDeps([0,1,2]),import.meta.url).then(e=>e.default);globalThis.sqlite3ApiConfig={silent:!0,debug:(...e)=>{},warn:(...e)=>{String(e[0]).includes("OPFS sqlite3_vfs")},error:(...e)=>{},log:(...e)=>{}};const r=await t();o=new r.oo1.DB}return o}async function y(t){if(window.sessionStorage.getItem("previewToken"))return o;let r=null;const e=`checksum_${t}`,n=`collection_${t}`;let a="matched";try{const i=o.exec({sql:`SELECT * FROM ${u.info} where id = '${e}'`,rowMode:"object",returnValue:"resultRows"}).shift();(i==null?void 0:i.version)!==d[String(t)]&&(a="mismatch")}catch{a="missing"}if(a!=="matched"){if(window.localStorage.getItem(`content_${e}`)===d[String(t)]&&(r=window.localStorage.getItem(`content_${n}`)),!r){r=await p(void 0,String(t));try{window.localStorage.setItem(`content_${e}`,d[String(t)]),window.localStorage.setItem(`content_${n}`,r)}catch{}}const i=await S(r);await o.exec({sql:`DROP TABLE IF EXISTS ${u[String(t)]}`}),a==="mismatch"&&await o.exec({sql:`DELETE FROM ${u.info} WHERE id = '${e}'`});for(const c of i)try{await o.exec(c)}catch{}}return o}export{R as loadDatabaseAdapter};
